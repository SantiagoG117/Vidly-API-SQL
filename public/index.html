<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vidly - Login/Register</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        min-height: 100vh;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        background-image: url("../resources/background_image.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }
      .auth-box {
        width: 100%;
        max-width: 400px;
        width: 100%;
        max-width: 400px;
        /* Two-color split: left btn-warning, right btn-primary */
        background: linear-gradient(
          to right,
          #ffc107 0%,
          #ffc107 50%,
          #0d6efd 50%,
          #0d6efd 100%
        );
        border-radius: 8px;
        box-shadow: 0 0 16px rgba(0, 0, 0, 0.08);
        padding: 2rem;
      }
      .switch-btns .btn {
        width: 50%;
      }
      .split-btn {
        background: linear-gradient(
          to right,
          #0d6efd 0%,
          #0d6efd 50%,
          #ffc107 50%,
          #ffc107 100%
        ) !important;
        color: #fff !important;
        border: none !important;
        position: relative;
        z-index: 1;
        transition: none;
      }
      .split-btn:focus,
      .split-btn:hover {
        filter: brightness(0.95);
      }
    </style>
  </head>
  <body>
    <div class="auth-box mx-auto">
      <div class="switch-btns d-flex mb-4">
        <button
          class="btn btn-primary m-1"
          id="showLogin"
          type="button"
          onclick="showForm('login')"
        >
          Login
        </button>
        <button
          class="btn btn-warning m-1"
          id="showRegister"
          type="button"
          onclick="showForm('register')"
        >
          Register
        </button>
      </div>
      <!-- Login Form -->
      <form id="loginForm">
        <h4 class="mb-3">Login</h4>
        <div class="mb-3">
          <label for="loginEmail" class="form-label">Email address</label>
          <input type="email" class="form-control" id="loginEmail" required />
        </div>
        <div class="mb-3">
          <label for="loginPassword" class="form-label">Password</label>
          <input
            type="password"
            class="form-control"
            id="loginPassword"
            required
          />
        </div>
        <button type="submit" class="btn btn-dark w-100">Login</button>
      </form>
      <!-- Register Form -->
      <form id="registerForm" style="display: none">
        <h4 class="mb-3">Register</h4>
        <div class="mb-3">
          <label for="registerFirstName" class="form-label">First Name</label>
          <input
            type="text"
            class="form-control"
            id="registerFirstName"
            required
          />
        </div>
        <div class="mb-3">
          <label for="registerLastName" class="form-label">Last Name</label>
          <input
            type="text"
            class="form-control"
            id="registerLastName"
            required
          />
        </div>
        <div class="mb-3">
          <label for="registerEmail" class="form-label">Email address</label>
          <input
            type="email"
            class="form-control"
            id="registerEmail"
            required
          />
        </div>
        <div class="mb-3">
          <label for="registerPassword" class="form-label">Password</label>
          <input
            type="password"
            class="form-control"
            id="registerPassword"
            required
          />
        </div>
        <div class="mb-3">
          <label for="registerIsAdmin" class="form-label"
            >Register as Admin?</label
          >
          <select class="form-select" id="registerIsAdmin" required>
            <option value="false" selected>User</option>
            <option value="true">Admin</option>
          </select>
        </div>
        <button type="submit" class="btn btn-dark w-100">Register</button>
      </form>
    </div>
    <script>
      //Add event listeners:
      document
        .getElementById("registerForm")
        .addEventListener("submit", registerUser);
      function showForm(form) {
        const loginBtn = document.getElementById("showLogin");
        const registerBtn = document.getElementById("showRegister");
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        if (form === "login") {
          loginForm.style.display = "";
          registerForm.style.display = "none";
          loginBtn.classList.add("btn-primary");
          registerBtn.classList.remove("btn-primary");
        } else {
          loginForm.style.display = "none";
          registerForm.style.display = "";
          registerBtn.classList.add("btn-primary");
        }
      }

      async function registerUser(event) {
        event.preventDefault();

        //Get values from the form:
        const firstName = document.getElementById("registerFirstName").value;
        const lastName = document.getElementById("registerLastName").value;
        const email = document.getElementById("registerEmail").value;
        const password = document.getElementById("registerPassword").value;
        const isAdmin =
          document.getElementById("registerIsAdmin").value === "true";

        //Build payload
        const payload = {
          firstName,
          lastName,
          email,
          password,
          isAdmin,
        };

        //Send POST request
        try {
          const response = await fetch("http://localhost:5000/api/users/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorText = await response.text();
            alert("Registration failed: " + errorText);
            return;
          }

          //Store the JSON Web token sent by the server
          const token = response.headers.get("x-auth-token");
          console.log(response);
          console.log(token);
          if (token) {
            localStorage.setItem("token", token);
            window.location.href = "home.html";
          } else {
            alert("Registration succeed but no token received");
          }
        } catch (err) {
          alert(err.message);
        }
      }
    </script>
  </body>
</html>
